\chapter{Proponowane rozwi±zanie}
\label{cha:rozwiazanie}

W rozdziale tym przedstawiono informacje .

%---------------------------------------------------------------------------

\section{Model narciarza i ¶rodowiska}
\label{sec:model}

W zaproponowanym rozwi±zaniu trzeba by³a podj±æ pewne decyzje odno¶nie reprezentacji ¶rodowiska oraz narciarza.
Zosta³o przyjête, ¿e stok traktowany jest jako p³aszczyzna, która jest nachylona pod okre¶lonym przez sta³± $\alpha$ k±tem do powierzchni ziemi. Za³o¿enie co do p³askiej powierzchni jest tylko ograniczeniem przyjêtym do testów. Umo¿liwia to ³atwiejsz± analizê wyników niezaburzonych zmianami nachylenia terenu. Jednak stworzony program mo¿e zostaæ zmodyfikowany tak, aby zamodelowaæ bardziej skomplikowan± powierzchniê. 
Narciarz traktowany jest jako punkt materialny o masie m. 
%---------------------------------------------------------------------------

\section{Opis matematyczny modelu}
\label{sec:matematycznyModel}

m - masa\\
g - wspó³czynnik grawitacji\\
$\alpha$ - k±t nachylenia powierzchni stoku do powierzchni ziemi\\

Si³a grawitacji dzia³aj±ca na obiekt o masie m:\\
\begin{equation}
Q = mg
\end{equation}

Si³a ta mo¿e zostaæ roz³o¿ona na dwie si³y sk³adowe wzglêdem powierzchni stoku. Narciarz poruszaj±cy siê w dó³ stoku przypomina klasyczny przyk³ad punktu materialnego staczaj±cego siê po równi pochy³ej.\\
Sk³adowa si³y grawitacji równoleg³a do powierzchni stoku:\\
\begin{equation}
Q_a = mg\sin\alpha
\end{equation}

jest to si³a ¶ci±gaj±ca narciarza w dó³ stoku.

Sk³adowa si³y grawitacji prostopad³a do powierzchni stoku:\\
\begin{equation}
F_n = mg\cos\alpha
\end{equation}

Warto¶æ tej si³y wp³ywa na warto¶æ si³y tarcia dzia³aj±cej na narciarza:\\
\begin{equation}
F_f = \mu F_n = \mu mg\cos\alpha
\end{equation}

Oprócz si³y tarcia uwzglêdniamy równie¿ inn± si³ê oporu jak± jest si³a oporu powietrza. Zale¿y ona od prêdko¶ci poruszania siê obiektu. Prêdko¶æ bêdziemy wyra¿aæ jako pierwsz± pochodn± po³o¿enia - $ \dot{x} $:\\
\begin{equation}
F_{d} = k_{1}\dot{x} + k_{2}\dot{x}^2
\end{equation}

Za³o¿enia, które narzucane s± na sta³e $ k_{1} $ oraz $ k_{2} $:\\
\begin{equation}
\left\{ \begin{array}{ll}
 k_{2} = 0  &\mbox{ $v \le B$} \\ 
 k_{1} = 0 &\mbox{ $v \geq  B$} 
\end{array} \right. 
\end{equation}\\
gdzie $ B $:\\
\begin{equation}
B = 4 \frac{m}{s}
\end{equation}

Ograniczenie to zosta³o zaczerpniête z pracy ???? (Aerodynamic-Drag) i opisane w rozdziale ????

Wspó³czynnik $ k_1 $ ....\\
\begin{equation}
k_1 = ... 
\end{equation}

Wspó³czynnik $ k_2 $ zosta³ opisany w ????\\
\begin{equation}
k_2 = \frac{1}{2} C \rho A
\end{equation}

gdzie:\\
$ C $ - wspó³czynnik oporu\\
$ \rho $ - gêsto¶æ powietrza\\
$ A $ - powierzchnia przednia narciarza prostopad³a do kieruku przep³ywu, a zatem prostopad³a do wektora prêdko¶ci narciarza

%---------------------------------------------------------------------------

\section{Numeryczne rozwi±zanie problemu}
\label{sec:numeryczneRozwiazanie}

Rozpatruj±c wszystkie si³y dzia³aj±ce na narciarza równoleg³e do powierzchni stoku, a wiêc powoduj±ce jego ruch w dó³, otrzymujemy nastêpuj±ce równanie:

\begin{equation}
ma=mgsin\alpha-\mu mgcos\alpha-k_{1}\dot{x} - k_{2}\dot{x}^{2}
\end{equation}

Wyra¼my teraz przyspieszenie jako drug± pochodn± po³o¿enia:

\begin{equation}
a = \ddot{x} 
\end{equation}

Podstawiaj±c do równania:

\begin{equation}
m\ddot{x}=mgsin\alpha-\mu mgcos\alpha-k_{1}\dot{x} - k_{2}\dot{x}^{2}
\end{equation}

Zatem po podzieleniu przez m:

\begin{equation}
\ddot{x}=gsin\alpha-\mu gcos\alpha-\frac{k_{1}}{m}\dot{x} - \frac{k_{2}}{m}\dot{x}^{2}
\end{equation}

Aby rozwi±zaæ to równanie numerycznie, wprowadzamy now± zmienn± v (odpowiadaj±c± prêdko¶ci):

\begin{equation}
v = \dot{x}
\end{equation}

Otrzymujemy nastêpuj±ce równania:\\
\begin{equation}
\left\{ \begin{array}{ll}
\dot{v} = gsin\alpha-\mu gcos\alpha-\frac{k_{1}}{m}v - \frac{k_{2}}{m}v^{2} \\
v = \dot{x}
\end{array} \right. 
\end{equation}

Pamiêtamy przy tym, ¿e:\\
\begin{equation}
\left\{ \begin{array}{ll}
 k_{2} = 0  &\mbox{ $v \le B$} \\ 
 k_{1} = 0 &\mbox{ $v \geq  B$} 
\end{array} \right. 
\end{equation}

Powy¿szy uk³ad równañ wystarczy wykorzystaæ w dostêpnych w wielu jêzykach funkcjach bibliotecznych do rozwi±zywania równañ ró¿niczkowych zwyczajnych. W naszym przypadku wykorzysta³y¶my funkcjê dopri (Numerical integration of ODE using Dormand-Prince RK method) z biblioteki Numeric Javascript.

\subsection{Rozwi±zanie w 3D}
Powy¿szy uk³ad równañ opisuje poruszanie siê punktu materialnego po równi pochy³ej. Jednak w przypadku narciarza przemieszczaj±cego siê po stoku musimy uwzglêdniæ równie¿ mo¿liwo¶æ poruszania siê w poprzek stoku, a nie tylko w dó³.\\
Za³ó¿my, ¿e narciarz porusza siê tylko po liniach prostych. \\
Rozpatrzmy teraz jak bêdzie wygl±da³ uk³ad si³ dzia³aj±cych na narciarza:\\

% obrazek

Na naszego narciarza dzia³aj± si³y: grawitacji - w kierunku pionowym oraz si³y oporu - w kierunku linii jazdy narciarza. Je¶li rozpatrzymy teraz uk³ad wspó³rzêdnych zorientowany wzglêdem kierunku jazdy, musimy najpierw zrzutowaæ si³ê grawitacji otrzymuj±c si³ê ¶ci±gaj±ca narciarza:

\begin{equation}
g\sin\alpha*sinus
\end{equation}

gdzie sinus to:

%-----------------------SINUS-------------------%

Zatem nasze równanie ruchu bêdzie wygl±da³o nastêpuj±co:

\begin{equation}
\ddot{x} = g\sin\alpha*sinus - (\mu F_n + \frac{k_1}{m}\dot{x} + \frac{k_2}{m}\dot{x}^2 )
\end{equation}

gdzie $F_n$ to si³a nacisku narciarza, która pozostaje taka sama jak w przypadku 2D:

\begin{equation}
F_n = gcos\alpha
\end{equation}

Transformuj±c powy¿sze równanie na uk³ad wspó³rzêdnych zorientowany wzd³u¿ i wszerz stoku otrzymamy nastêpj±ce równania:

% sprawdzic x i y 

\begin{equation}
\left\{ \begin{array}{ll}
\ddot{x_x} = (g*\sin\alpha*sinus - (\mu*F_n + \frac{k_1}{m}\dot{x} + \frac{k_2}{m}\dot{x}^2))*sinus\\
\ddot{x_y} = (g*\sin\alpha*sinus - (\mu*F_n + \frac{k_1}{m}\dot{x} + \frac{k_2}{m}\dot{x}^2))*cosinus
\end{array} \right.
\end{equation}

Po wprowadzeniu jak poprzednio dodatkowych zmiennych, w tym wypadku prêdko¶ci $v_x$ i $v_y$ oraz pamiêtaniu o zale¿no¶ci miêdzy nimi a pochodn± przemieszczenia:

\begin{equation}
\left\{ \begin{array}{ll}
v_x = \dot{x_x}\\
v_y = \dot{x_y}\\
\dot{x} = \sqrt{v_x^2 +v_y^2}
\end{array} \right.
\end{equation}

otrzymujemy:

\begin{equation}
\left\{ \begin{array}{ll}
v_x = \dot{x_x}\\
v_y = \dot{x_y}\\
\dot{v_x} = (g*\sin\alpha*sinus - (\mu*N + \frac{k_1}{m}\dot{x} + \frac{k_2}{m}\dot{x}^2))*sinus\\
\dot{v_y} = (g*\sin\alpha*sinus - (\mu*N + \frac{k_1}{m}\dot{x} + \frac{k_2}{m}\dot{x}^2))*cosinus
\end{array} \right. 
\end{equation}\\


%---------------wzory razem z zakrêtami - gdzie?--------

$$
\left\{\begin{array}{ll} 
  v_x=\dot{x_x} \\
  v_y=\dot{x_y} \\
 \dot{v_x} = gsin\alpha - (\dot{x_x}^2 +\dot{x_y}^2)^{\frac{1}{2}} \kappa \dot{x_y} sgn(\dot{\varphi}) - gsin\alpha \frac{\dot{x_y}^2}{\dot{x_x}^2 +\dot{x_y}^2} - \frac{(F_f + F_d) }{m}\frac{\dot{x_x}}{(\dot{x_x}^2 +\dot{x_y}^2)^{\frac{1}{2}}} \\
 \dot{v_y} = (\dot{x_x}^2 +\dot{x_y}^2)^{\frac{1}{2}} \kappa \dot{x_x} sgn(\dot{\varphi}) + gsin\alpha \frac{\dot{x_x}} {\dot{x_x}^2 +\dot{x_y}^2} - \frac{(F_f + F_d)}{m}\frac{\dot{x_y}}{(\dot{x_x}^2 +\dot{x_y}^2)^{\frac{1}{2}}} 
\end{array}\right.
$$\\
%---------------------------------------------------------------------------

\section{Optymalizacja toru przejazdu}
\label{sec:optymalizacja}


\subsection{Algorytm ewolucyjny}
Aby znale¼æ rozwi±zanie problemu, nale¿y przyj±æ jaki¶ sposób reprezentacji ka¿dego z rozwi±zañ. Tor przejazdu narciarza w rzeczywisto¶ci to ¶lad, który pozostawiaj± narty na ¶niegu w trakcie przemieszczania siê po stoku. Jak opisano w rozdziale \ref{sec:matematycznyModel} ????, w celu uproszczenia sposobu przemieszczania siê narciarza, zosta³o zdecydowane, ¿e jako przybli¿enie mo¿na przyj±æ poruszanie siê po ³amanej. Zatem do reprezentacji rozwi±zania mo¿na przyj±æ zbiór punktów, przez które kolejno przeje¿d¿a narciarz, poruszaj±c siê miêdzy tymi punktami wy³±cznie po linii prostej.\\
Jednak wci±¿ takie podej¶ie jest zbyt ogólne, poniewa¿ w algorytmie ewolucyjnym potrzebujemy sta³ej liczby punktów, aby móc wykonywaæ np. krzy¿owanie dwóch osobników. Zatem w zaproponowonym rozwi±zaniu narzucamy z góry co ile metrów w pionie stoku ma pojawiæ siê punkt. Oprócz tego narzucone zosta³o, ¿e narciarz musi przejechaæ jak najbli¿ej wewnêtrznej bramki co indykuje do³o¿enie punktu w miejscu ka¿dej wewnêtrznej bramki.\\
Punkty te, a ¶ci¶lej, ich po³o¿enie w pozycji poziomej jest reprezentacj± konkretnego rozwi±zania problemu i w ten sposób w³a¶nie okre¶lony jest genotyp ka¿dego osobnika. Nie wprowadzamy tu typowego dla algorytmów genetycznych kodowania binarnego, pozycja punktu jest zapamiêtana jako warto¶æ rzeczywista.\\
Dodatkowo do genotypu wchodzi tak¿e parametr $\sigma$, który w strategiach ewolucyjnych u¿ywany jest podczas mutacji tak jak opisano w rozdziale \ref{cha:wstepTeoretyczny} w czêsci o strategiach.

Zastosowany algorytm opiera siê na strategii ($\mu$ + $\lambda$) opisanej w rozdziale \ref{cha:wstepTeoretyczny}. Jako pocz±tkow± populacjê wybieramy losowe osobniki - poziome warto¶ci punktów s± ograniczone jedynie przez warto¶ci poziome po³o¿enia dwóch najbli¿szych bramek. Jest to kierowane konieczno¶ci± zadbania o szybsze znalezienie rozwi±zania - zbyt du¿e odleg³o¶ci mo¿na z góry odrzuciæ opieraj±c siê na do¶wiadczeniach z rzeczywistej jazdy narciarza po slalomie. Wielko¶æ populacji bazowej $\mu$ jest jednym z parametrów programu, ale najczê¶ciej warto¶æ ta wynosi 30. Warto¶æ parametru $\lambda$ tak¿e jest parametrem, jednak w testach przewa¿nie u¿yto wielko¶ci 100.\\
Szkielet algorytmu zgodny jest z zastosowan± strategi±, po wylosowaniu z istniej±cej populacji populacji tymczasowej o wielko¶ci $\lambda$, dokonuje siê na jej osobnikach operacji genetycznych, najpierw krzy¿owania, a nastêpnie mutacji na osobnikach otrzymanych z krzy¿owania. Kolejnym krokiem jest ocenienie nowych osobników i wybranie spo¶ród nich oraz populacji pocz±tkowej osobników o najlepszym przystosowaniu i to one stanowi± now± populacjê bazow±.

\subsubsection{Krzy¿owanie}
Aby dokonaæ krzy¿owania potrzebne s± pary rodziców dla ka¿dego nowego osobnika. Aby utrzymaæ wielko¶æ populacji tymczasowej, losujemy (ze zwracaniem) $\lambda$ par spo¶ród populacji tymczasowej. Krzy¿owanie rodziców sprowadza siê do obliczenia ¶redniej warto¶ci po³o¿enia odpowiadaj±cych sobie punktów oraz parametrów $\sigma$.

\subsubsection{Mutacja}


%---------------------------------------------------------------------------

\section{Architektura systemu}
\label{sec:architektura}

%---------------------------------------------------------------------------

